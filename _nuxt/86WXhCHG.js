import{_ as T,r as i,j as G,t as d,z as t,A as n,v as c,am as h,x as r,aG as M,a8 as U,bb as D,B as E,aT as J,bc as O,bd as $,au as Z,as as H,aC as W}from"./BgcB-hOa.js";import{E as X,w as q,z as K,x as Q,y as Y}from"./C6gQdffp.js";import{E as ee}from"./5ALttNZ2.js";import{E as te}from"./SO6lA4p9.js";import{E as ae}from"./DEztFZNs.js";import{E as b}from"./C0SJ_CHT.js";import{J as le}from"./Do5W3BPA.js";const se={class:"container"},oe={key:0,class:"text-center"},ne={key:0,class:"text-center"},re={key:1,class:"text-center"},ie={key:2,class:"image-container"},de={key:0,class:"divided-images mt-4"},ce={class:"mt-4 text-right"},ue=10*1024*1024,me={__name:"divide",setup(pe){const y=i(""),w=i(null),x=i(2),_=i(2),p=i(!1),k=i(!1),u=i(""),f=i([]),C=["image/jpeg","image/png"],V=G(()=>({display:"grid",gridTemplateColumns:`repeat(${_.value}, 1fr)`,gap:"10px",marginTop:"10px"})),L=async a=>{const e=a.raw;if(F(e)){p.value=!0,u.value="";try{const s=new FileReader;s.onload=l=>{const o=new Image;o.onload=()=>{y.value=l.target.result,w.value=o,p.value=!1},o.onerror=()=>{u.value="图片加载失败",p.value=!1},o.src=l.target.result},s.readAsDataURL(e)}catch{u.value="图片处理失败",p.value=!1}}},F=a=>C.includes(a.type)?a.size>ue?(b.error("图片大小不能超过 10MB"),!1):!0:(b.error("请上传 JPG 或 PNG 格式的图片"),!1),z=async()=>{if(w.value){k.value=!0,f.value=[];try{const a=document.createElement("canvas"),e=a.getContext("2d"),s=w.value,l=s.width/_.value,o=s.height/x.value;for(let m=0;m<x.value;m++)for(let v=0;v<_.value;v++)a.width=l,a.height=o,e.clearRect(0,0,a.width,a.height),e.drawImage(s,v*l,m*o,l,o,0,0,l,o),f.value.push(a.toDataURL("image/png"))}catch{b.error("图片分割失败")}finally{k.value=!1}}},A=async()=>{const a=new le,e=a.folder("divided-images");f.value.forEach((s,l)=>{const o=s.replace(/^data:image\/(png|jpg);base64,/,"");e.file(`divided-image-${l+1}.png`,o,{base64:!0})});try{const s=await a.generateAsync({type:"blob"}),l=document.createElement("a");l.href=URL.createObjectURL(s),l.download="divided-images.zip",l.click(),URL.revokeObjectURL(l.href)}catch{b.error("打包下载失败")}};return(a,e)=>{const s=M,l=q,o=ee,m=K,v=te,I=ae,R=$,N=O,P=Y,S=Q,j=X;return c(),d("div",se,[t(j,null,{header:n(()=>e[3]||(e[3]=[r("div",{class:"text-center"},[r("span",{class:"text-xl font-medium"},"图片分割")],-1)])),default:n(()=>[t(l,{class:"upload-area",drag:"","auto-upload":!1,"show-file-list":!1,accept:"image/*","on-change":L},{trigger:n(()=>[!y.value&&!p.value&&!u.value?(c(),d("div",oe,[t(s,{class:"el-icon--upload mx-auto block"},{default:n(()=>[t(U(D))]),_:1}),e[4]||(e[4]=r("div",{class:"el-upload__text"},[E(" 拖拽图片到此处或 "),r("em",null,"点击上传")],-1)),e[5]||(e[5]=r("div",{class:"text-sm text-gray-400 mt-2"},"支持 JPG、PNG 格式",-1))])):h("",!0)]),_:1}),p.value?(c(),d("div",ne,[t(s,{class:"is-loading",size:24},{default:n(()=>[t(U(J))]),_:1}),e[6]||(e[6]=r("div",{class:"text-gray-600"},"正在处理图片...",-1))])):u.value?(c(),d("div",re,[t(o,{title:u.value,type:"error",closable:!1},null,8,["title"]),t(m,{type:"primary",onClick:e[0]||(e[0]=g=>u.value="")},{default:n(()=>e[7]||(e[7]=[E(" 重试 ")])),_:1})])):y.value?(c(),d("div",ie,[t(v,{src:y.value,fit:"contain",class:"preview-image"},null,8,["src"]),t(S,{class:"mt-4"},{default:n(()=>[t(P,{label:"分割设置"},{default:n(()=>[t(N,{gutter:20},{default:n(()=>[t(R,{span:12},{default:n(()=>[t(I,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=g=>x.value=g),min:1,max:10,label:"行数",placeholder:"行数"},null,8,["modelValue"])]),_:1}),t(R,{span:12},{default:n(()=>[t(I,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=g=>_.value=g),min:1,max:10,label:"列数",placeholder:"列数"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(m,{type:"primary",onClick:z,loading:k.value},{default:n(()=>e[8]||(e[8]=[E(" 开始分割 ")])),_:1},8,["loading"])]),_:1}),f.value.length>0?(c(),d("div",de,[e[10]||(e[10]=r("h3",{class:"text-lg font-medium mb-2"},"分割结果预览",-1)),r("div",{class:"grid-container",style:Z(V.value)},[(c(!0),d(H,null,W(f.value,(g,B)=>(c(),d("div",{key:B,class:"grid-item"},[t(v,{src:g,fit:"contain",class:"divided-image"},null,8,["src"])]))),128))],4),r("div",ce,[t(m,{type:"primary",onClick:A},{default:n(()=>e[9]||(e[9]=[E(" 下载全部 ")])),_:1})])])):h("",!0)])):h("",!0)]),_:1})])}}},be=T(me,[["__scopeId","data-v-9d0aab31"]]);export{be as default};
